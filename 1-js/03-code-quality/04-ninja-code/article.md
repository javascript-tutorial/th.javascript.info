# โค้ดนินจา

```quote author="ขงจื๊อ (คำภีร์)"
ไร้คิดร่ำเรียน เสมือนไร้ผล หลงคิดไร้เรียน อันตรายหนา
```

นักเขียนโปรแกรมนินจาในอดีตใช้เคล็ดลับเหล่านี้เพื่อลับสมองของผู้ดูแลโค้ด

กูรูการรีวิวโค้ดมองหาพวกเขาในงานทดสอบ

นักพัฒนามือใหม่บางครั้งใช้เคล็ดลับเหล่านี้ได้ดีกว่านักโปรแกรมนินจาเสียอีก

อ่านอย่างถี่ถ้วนและหาว่าคุณเป็นใคร -- นินจา มือใหม่ หรืออาจเป็นผู้รีวิวโค้ด?  

```warn header="ตรวจพบการเสียดสี"
หลายคนพยายามเดินตามเส้นทางของนินจา แต่มีเพียงไม่กี่คนที่ประสบความสำเร็จ
```

## ความกระชับเป็นแก่นของไหวพริบ

ทำให้โค้ดสั้นที่สุดเท่าที่จะเป็นไปได้ แสดงให้เห็นว่าคุณฉลาดแค่ไหน

ให้คุณสมบัติภาษาที่ซับซ้อนเป็นแนวทางคุณ

ตัวอย่างเช่น ดูที่ตัวดำเนินการแบบสามทางนี้ `'?'`:

```js
// เอามาจากไลบรารี JavaScript ที่มีชื่อเสียงแห่งหนึ่ง
i = i ? i < 0 ? Math.max(0, len + i) : i : 0;
```

เจ๋งใช่ไหม? ถ้าคุณเขียนแบบนี้ นักพัฒนาที่เจอบรรทัดนี้และพยายามเข้าใจว่าค่าของ `i` เป็นเท่าไหร่ จะต้องใช้เวลาสนุกสนาน แล้วจะมาหาคุณเพื่อขอคำตอบ

บอกพวกเขาว่าสั้นกว่าดีกว่าเสมอ ฝึกให้พวกเขาสู่เส้นทางนินจา

## ตัวแปรอักษรตัวเดียว

```quote author="เล่าจื๊อ (เต๋าเต๋อจิง)"
เต๋าซ่อนอยู่ในความเงียบงัน มีเพียงเต๋าเท่านั้นที่เริ่มต้นและจบลงอย่างสมบูรณ์
```

อีกวิธีหนึ่งในการเขียนโค้ดให้สั้นลงคือการใช้ชื่อตัวแปรอักษรเดียวทุกที่ เช่น `a`, `b` หรือ `c`

ตัวแปรสั้นๆ จะหายไปในโค้ดเหมือนนินจาจริงๆ ในป่า ไม่มีใครหาพบได้ด้วย "ค้นหา" ในเครื่องมือแก้ไขโค้ด และแม้ใครจะเจอ พวกเขาก็จะไม่สามารถ "ถอดรหัส" ได้ว่าชื่อ `a` หรือ `b` หมายถึงอะไร

...แต่มีข้อยกเว้น นินจาแท้จริงจะไม่ใช้ `i` เป็นตัวนับในลูป `"for"` ทุกที่ยกเว้นที่นี่  มองไปรอบๆ มีตัวอักษรแปลกๆ อีกมาก เช่น `x` หรือ `y`

ตัวแปรแปลกๆ เป็นตัวนับลูปโดยเฉพาะแล้วจะเจ๋งมาก ถ้าเนื้อหาในลูปยาว 1-2 หน้า (ยิ่งยาวยิ่งดี) จากนั้น ถ้ามีใครมองเข้าไปในลูปลึกๆ พวกเขาจะไม่สามารถเดาได้อย่างรวดเร็วว่าตัวแปรที่ชื่อ `x` คือตัวนับของลูป

## ใช้ตัวย่อ

ถ้ากฎของทีมห้ามใช้ชื่อตัวอักษรเดียวหรือชื่อที่คลุมเครือ -- ย่อมัน ทำเป็นตัวย่อ

แบบนี้:

- `list` -> `lst`
- `userAgent` -> `ua`  
- `browser` -> `brsr`
- ...เป็นต้น

เฉพาะคนที่มีสัญชาตญาณดีจริงๆ เท่านั้นที่จะเข้าใจชื่อเหล่านี้ได้ พยายามย่อทุกอย่าง มีเพียงคนที่คู่ควรเท่านั้นที่จะสามารถสานต่อการพัฒนาโค้ดของคุณ

## โบยบินสูง เป็นนามธรรม

```quote author="เล่าจื๊อ (เต๋าเต๋อจิง)"
มุมมนลับเลือน จตุรัสใหญ่
ภาชนะโล่งว่าง บรรจุความสมบูรณ์
เสียงท่วงทำนอง ริบหรี่อันไพเราะ
รูปโฉมไร้เงา สะท้อนความยิ่งใหญ่
```

ขณะเลือกชื่อ พยายามใช้คำที่เป็นนามธรรมที่สุด เช่น `obj`, `data`, `value`, `item`, `elem` และอื่นๆ

- **ชื่อในอุดมคติสำหรับตัวแปรคือ `data`** ใช้มันได้ทุกที่ที่ทำได้ แท้จริงแล้วทุกตัวแปรเก็บ *ข้อมูล* ใช่ไหม?

    ...แต่ถ้า `data` ถูกใช้ไปแล้วล่ะ? ลองใช้ `value` มันก็ใช้ได้กับทุกอย่างเช่นกัน ในท้ายที่สุด ตัวแปรจะได้รับ *ค่า*  

- **ตั้งชื่อตัวแปรตามประเภทของมัน: `str`, `num`...**

    ลองดูสิ ผู้ฝึกหัดมือใหม่อาจสงสัยว่า ชื่อแบบนี้มีประโยชน์จริงๆ สำหรับนินจาหรือ? แน่นอน มีสิ!  

    แน่นอน ชื่อตัวแปรก็ยังหมายความบางอย่าง มันบอกว่าอะไรอยู่ในตัวแปร: สตริง, ตัวเลข หรืออย่างอื่น แต่เมื่อคนนอกพยายามทำความเข้าใจโค้ด พวกเขาจะประหลาดใจที่เห็นว่าจริงๆ แล้วไม่มีข้อมูลอะไรเลย! และในที่สุดก็จะล้มเหลวที่จะเปลี่ยนแปลงโค้ดที่คุณคิดไว้อย่างดี

    ประเภทของค่านั้นหาได้ง่ายด้วยการดีบั๊ก แต่ความหมายของตัวแปรล่ะ? สตริง/ตัวเลขใดที่มันเก็บไว้?

    ไม่มีทางรู้ได้เลยหากไม่ใช้สมาธิที่ดี!

- **...แต่ถ้าไม่มีชื่อแบบนี้แล้วล่ะ?** ก็แค่เพิ่มตัวเลข: `data1, item2, elem5`...  

## การทดสอบความใส่ใจ

มีเพียงโปรแกรมเมอร์ที่ตั้งใจจริงๆ เท่านั้นที่จะเข้าใจโค้ดของคุณได้ แต่จะตรวจสอบได้อย่างไร?

**หนึ่งในวิธี -- ใช้ชื่อตัวแปรที่คล้ายกัน เช่น `date` และ `data`**

ผสมมันในที่ที่ทำได้

การอ่านโค้ดแบบนี้อย่างรวดเร็วเป็นไปไม่ได้ และเมื่อมีการพิมพ์ผิด... อืมม์... เราก็ติดกับดักนาน ได้เวลาดื่มชากันแล้ว

## คำพ้องความหมายอัจฉริยะ

```quote author="เล่าจื๊อ (เต๋าเต๋อจิง)"
เต๋าอันแท้จริงไร้ถ้อยใดบรรยาย นามอันแท้จริงไร้ชื่อใดเรียกขาน
```

การใช้ชื่อที่*คล้ายกัน*สำหรับสิ่งที่*เหมือนกัน* ทำให้ชีวิตน่าสนใจยิ่งขึ้นและแสดงความคิดสร้างสรรค์ของคุณต่อสาธารณะ

ตัวอย่างเช่น พิจารณาคำนำหน้าฟังก์ชัน ถ้าฟังก์ชันแสดงข้อความบนหน้าจอ -- เริ่มต้นด้วย `display…` เช่น `displayMessage` และถ้าฟังก์ชันอื่นแสดงอย่างอื่นบนหน้าจอ เช่นชื่อผู้ใช้ ให้เริ่มต้นด้วย `show…` (เช่น `showName`)

บอกเป็นนัยว่ามีความแตกต่างเล็กน้อยระหว่างฟังก์ชันดังกล่าว แต่จริงๆ แล้วไม่มี

ทำข้อตกลงกับนินจาในทีม: ถ้า John เริ่ม "แสดง" ฟังก์ชันด้วย `display...` ในโค้ดของเขา แล้ว Peter อาจใช้ `render..` และ Ann -- `paint...` สังเกตว่าโค้ดน่าสนใจและหลากหลายขึ้นมากแค่ไหน  

...และตอนนี้เทคนิคเด็ด!

สำหรับฟังก์ชันสองตัวที่มีความแตกต่างสำคัญ -- ใช้คำนำหน้าเดียวกัน!

ตัวอย่างเช่น ฟังก์ชัน `printPage(page)` จะใช้เครื่องพิมพ์ และฟังก์ชัน `printText(text)` จะวางข้อความบนหน้าจอ ให้ผู้อ่านที่ไม่คุ้นเคยคิดให้ดีเกี่ยวกับฟังก์ชัน `printMessage` ที่ตั้งชื่อคล้ายกัน: "มันวางข้อความไว้ที่ไหน? ในเครื่องพิมพ์หรือบนหน้าจอ?" ในการทำให้มันเจิดจริงๆ `printMessage(message)` ควรแสดงผลมันในหน้าต่างใหม่!

## นำชื่อกลับมาใช้ใหม่

```quote author="เล่าจื๊อ (เต๋าเต๋อจิง)"
เมื่อองค์รวมแยกสลาย
สรรพสิ่งล้วนปรากฏนาม
นามมากมายล้นหลาม
ควรหยุดยั้งเมื่อพอดี
```

เพิ่มตัวแปรใหม่ก็ต่อเมื่อจำเป็นจริงๆ เท่านั้น

แทนที่จะทำแบบนั้น ให้นำชื่อที่มีอยู่แล้วกลับมาใช้ใหม่ เพียงแค่เขียนค่าใหม่ลงไปในตัวแปรเหล่านั้น

ในฟังก์ชัน พยายามใช้เฉพาะตัวแปรที่ส่งเข้ามาเป็นพารามิเตอร์ 

นั่นจะทำให้ยากจริงๆ ที่จะระบุว่ามีอะไรอยู่ในตัวแปร *ตอนนี้* และมาจากที่ไหน จุดประสงค์คือการพัฒนาสัญชาตญาณและความจำของคนที่อ่านโค้ด คนที่มีสัญชาตญาณอ่อนแอจะต้องวิเคราะห์โค้ดทีละบรรทัดและติดตามการเปลี่ยนแปลงผ่านทุกสาขาของโค้ด

**ตัวแปรขั้นสูงของวิธีนี้คือการแอบ (!) แทนที่ค่าด้วยอะไรที่คล้ายๆ กันในระหว่างลูปหรือฟังก์ชัน**

ตัวอย่างเช่น:

```js
function ninjaFunction(elem) {
  // 20 บรรทัดโค้ดทำงานกับ elem

  elem = clone(elem);

  // อีก 20 บรรทัด ตอนนี้ทำงานกับโคลนของ elem!
}
```

โปรแกรมเมอร์เพื่อนร่วมงานที่ต้องการทำงานกับ `elem` ในครึ่งหลังของฟังก์ชันจะประหลาดใจ... จนกระทั่งระหว่างดีบั๊ก หลังจากตรวจสอบโค้ดแล้วพวกเขาจะพบว่ากำลังทำงานกับโคลน!

เห็นในโค้ดเป็นประจำ มีประสิทธิภาพถึงตายแม้กระทั่งกับนินจาที่มีประสบการณ์

## ขีดล่างเพื่อความสนุก

ใส่ขีดล่าง `_` และ `__` ไว้ข้างหน้าชื่อตัวแปร เช่น `_name` หรือ `__value` จะดีมากถ้ามีแค่คุณเท่านั้นที่รู้ความหมายของพวกมัน หรือที่ดีกว่านั้น เพิ่มพวกมันเข้าไปเพื่อความสนุกเฉยๆ โดยไม่มีความหมายอะไรเป็นพิเศษเลย หรือความหมายที่แตกต่างกันในที่ต่างๆ

คุณฆ่ากระต่ายสองตัวด้วยหนึ่งนัด ประการแรก โค้ดจะยาวขึ้นและอ่านยากขึ้น และประการที่สอง นักพัฒนาเพื่อนร่วมงานอาจใช้เวลานานในการพยายามคิดว่าขีดล่างหมายถึงอะไร

นินจาฉลาดวางขีดล่างในจุดหนึ่งของโค้ดและหลบเลี่ยงมันในอีกที่ นั่นทำให้โค้ดเปราะบางยิ่งขึ้นและเพิ่มโอกาสที่จะเกิดข้อผิดพลาดในอนาคต

## แสดงความรักของคุณ

ให้ทุกคนเห็นว่า entities ของคุณยิ่งใหญ่แค่ไหน! ชื่อเช่น `superElement`, `megaFrame` และ `niceItem` จะทำให้ผู้อ่านตาสว่างอย่างแน่นอน  

แน่นอน จากด้านหนึ่ง มีบางอย่างเขียนอยู่: `super..`, `mega..`, `nice..` แต่อีกด้านหนึ่ง -- มันไม่ได้ให้รายละเอียดอะไรเลย ผู้อ่านอาจตัดสินใจมองหาความหมายที่ซ่อนอยู่และนั่งสมาธิสักชั่วโมงสองชั่วโมงของเวลาทำงานที่ได้รับค่าจ้าง

## ทับตัวแปรภายนอก

```quote author="กวนอินจื้อ"
เมื่ออยู่ในแสง จะมองไม่เห็นอะไรในความมืด
เมื่ออยู่ในความมืด จะมองเห็นทุกอย่างในแสง  
```

ใช้ชื่อเดียวกันสำหรับตัวแปรภายในและภายนอกฟังก์ชัน ง่ายมาก ไม่ต้องพยายามคิดชื่อใหม่

```js
let *!*user*/!* = authenticateUser();

function render() {
  let *!*user*/!* = anotherValue();
  ...
  ...หลายบรรทัด...
  ...
  ... // <-- โปรแกรมเมอร์ต้องการใช้งานกับ user ที่นี่และ...
  ...
}
```

โปรแกรมเมอร์ที่กระโดดเข้าไปใน `render` อาจจะไม่สังเกตเห็นว่ามี `user` ภายในที่บดบัง `user` ภายนอกอยู่

แล้วพวกเขาจะพยายามทำงานกับ `user` โดยคิดว่ามันคือตัวแปรภายนอก ซึ่งเป็นผลมาจาก `authenticateUser()`... กับดักถูกวางไว้! สวัสดี debugger...

## ผลข้างเคียง (Side-effects) ทุกหนทุกแห่ง!

มีฟังก์ชันที่ดูเหมือนไม่ได้เปลี่ยนแปลงอะไร เช่น `isReady()`, `checkPermission()`, `findTags()`... พวกมันถูกสมมติว่าจะทำการคำนวณ ค้นหาและส่งข้อมูลกลับ โดยไม่เปลี่ยนแปลงอะไรภายนอก หรือก็คือไม่มี "ผลข้างเคียง"

**เคล็ดลับที่สวยงามจริงๆ คือการเพิ่มการกระทำที่ "มีประโยชน์" เข้าไปในนั้น นอกเหนือจากงานหลัก** 

สีหน้าประหลาดใจอึ้งๆ บนใบหน้าของเพื่อนร่วมงานเมื่อพวกเขาเห็นฟังก์ชันชื่อ `is..`, `check..` หรือ `find...` ที่เปลี่ยนแปลงบางอย่าง -- จะขยายขอบเขตเหตุผลของคุณอย่างแน่นอน

**อีกวิธีในการทำให้ประหลาดใจคือการส่งผลลัพธ์ที่ไม่ได้มาตรฐานกลับ**

แสดงความคิดริเริ่มของคุณ! ให้การเรียก `checkPermission` ส่งกลับไม่ใช่ `true/false` แต่เป็นออบเจ็กต์ที่ซับซ้อนพร้อมกับผลการตรวจสอบ

นักพัฒนาที่พยายามเขียน `if (checkPermission(..))` จะสงสัยว่าทำไมมันถึงไม่ทำงาน บอกพวกเขาว่า: "อ่านเอกสารสิ!" และให้บทความนี้

## ฟังก์ชันทรงพลัง!

```quote author="เล่าจื๊อ (เต๋าเต๋อจิง)"
เต๋าใหญ่ไหลไปทุกหนทุกแห่ง
ทั้งไปทางซ้ายและทางขวา
```

อย่าจำกัดฟังก์ชันด้วยสิ่งที่เขียนไว้ในชื่อของมัน คิดให้กว้างขึ้น

ตัวอย่างเช่น ฟังก์ชัน `validateEmail(email)` สามารถ (นอกเหนือจากการตรวจสอบความถูกต้องของอีเมล) แสดงข้อความแสดงข้อผิดพลาดและขอให้ป้อนอีเมลใหม่ได้

การกระทำเพิ่มเติมไม่ควรเห็นได้ชัดเจนจากชื่อฟังก์ชัน นินจาโค้ดเดอร์ตัวจริงจะทำให้พวกมันไม่ชัดเจนจากโค้ดเช่นกัน

**การรวมหลายการกระทำเข้าด้วยกันจะปกป้องโค้ดของคุณจากการนำกลับมาใช้ใหม่**

ลองจินตนาการว่า นักพัฒนาอีกคนต้องการแค่ตรวจสอบอีเมล ไม่ใช่แสดงข้อความใดๆ ฟังก์ชัน `validateEmail(email)` ของคุณที่ทำทั้งสองอย่างจะไม่เหมาะกับพวกเขา ดังนั้นพวกเขาจะไม่รบกวนสมาธิของคุณด้วยการถามอะไรเกี่ยวกับมัน

## สรุป

ทุก "คำแนะนำ" ข้างต้นมาจากโค้ดจริง... บางครั้งเขียนโดยนักพัฒนาที่มีประสบการณ์ บางทีอาจจะมีประสบการณ์มากกว่าคุณด้วยซ้ำ ;)

- ทำตามบางข้อ และโค้ดของคุณจะเต็มไปด้วยเรื่องน่าประหลาดใจ
- ทำตามหลายๆ ข้อ และโค้ดของคุณจะกลายเป็นของคุณจริงๆ ไม่มีใครอยากเปลี่ยนแปลงมัน
- ทำตามทุกข้อ และโค้ดของคุณจะกลายเป็นบทเรียนอันล้ำค่าสำหรับนักพัฒนารุ่นใหม่ที่กำลังมองหาการรู้แจ้ง
