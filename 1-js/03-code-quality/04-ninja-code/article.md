## การเขียนโค้ดแบบนินจา

```quote author="ขงจื๊อ (หลุนอวี่)"
ไร้คิดร่ำเรียน เสมือนไร้ผล หลงคิดไร้เรียน อันตรายหนา
```

เหล่านินจาโปรแกรมเมอร์ในอดีตใช้เทคนิคเหล่านี้เพื่อฝึกฝนจิตใจของผู้ดูแลรักษาโค้ด

ผู้เชี่ยวชาญด้านการตรวจสอบโค้ดมองหาเทคนิคเหล่านี้ในการทดสอบ

นักพัฒนาซอฟต์แวร์มือใหม่บางครั้งใช้เทคนิคเหล่านี้ได้ดีกว่านินจาโปรแกรมเมอร์ด้วยซ้ำ

อ่านอย่างละเอียดและค้นหาว่าคุณเป็นใคร -- นินจา, มือใหม่, หรืออาจจะเป็นผู้ตรวจสอบโค้ด?

```warn header="ตรวจพบความขัดแย้ง"
หลายคนพยายามเดินตามเส้นทางของนินจา แต่มีเพียงไม่กี่คนที่ประสบความสำเร็จ
```


## ความกระชับคือหัวใจของปัญญา

เขียนโค้ดให้สั้นที่สุดเท่าที่จะเป็นไปได้ แสดงให้เห็นว่าคุณฉลาดแค่ไหน

ปล่อยให้คุณสมบัติทางภาษาที่ละเอียดอ่อนนำทางคุณ

ตัวอย่างเช่น ลองดูตัวดำเนินการแบบไตรภาคี `'?'`:

```js
// นำมาจากไลบรารี javascript ที่รู้จักกันดี
i = i ? i < 0 ? Math.max(0, len + i) : i : 0;
```

เจ๋งใช่มั้ย? ถ้าคุณเขียนแบบนั้น นักพัฒนาที่เจอบรรทัดนี้และพยายามทำความเข้าใจว่าค่าของ `i` คืออะไร จากนั้นก็มาหาคุณเพื่อหาคำตอบ

บอกพวกเขาว่าอะไรที่สั้นๆนั้นดีกว่าเสมอ เริ่มต้นพวกเขาด้วยเส้นทางของนินจา

## ตัวแปรตัวอักษรเดียว (One-letter variables)

```quote author="เล่าจื๊อ (เต้าเต๋อจิง)"
เต๋าซ่อนอยู่ในความเงียบงัน มีเพียงเต๋าเท่านั้นที่เริ่มต้นและจบลงอย่างสมบูรณ์
```

อีกวิธีหนึ่งในการเขียนโค้ดให้สั้นลงคือใช้ชื่อตัวแปรตัวอักษรเดียวทุกที่ เช่น `a`, `b` หรือ `c`.

ตัวแปรสั้นๆ จะหายไปในโค้ดเหมือนนินจาตัวจริงในป่า ไม่มีใครสามารถค้นหาได้โดยใช้ "ค้นหา" ของโปรแกรมแก้ไข และแม้ว่าใครบางคนจะทำได้ พวกเขาก็ไม่สามารถ "ถอดรหัส" ได้ว่าชื่อ `a` หรือ `b` หมายถึงอะไร

...แต่มีข้อยกเว้น นินจาตัวจริงจะไม่ใช้ `i` เป็นตัวนับในลูป `"for"` ที่ไหนก็ตาม แต่ไม่ใช่ที่นี่ มองไปรอบ ๆ มีตัวอักษรแปลกใหม่มากมาย ตัวอย่างเช่น `x` หรือ `y`.

ตัวแปรที่แปลกใหม่เป็นตัวนับลูปจะเท่ห์เป็นพิเศษหากเนื้อหาของลูปใช้เวลา 1-2 หน้า (ทำให้ยาวขึ้นหากคุณทำได้) จากนั้นหากใครบางคนมองเข้าไปในลูปอย่างลึกซึ้ง พวกเขาจะไม่สามารถระบุได้อย่างรวดเร็วว่าตัวแปรชื่อ `x` คือตัวนับลูป

## ใช้ตัวย่อ

หากกฎของทีมห้ามใช้ชื่อตัวแปรตัวอักษรเดียวและชื่อที่คลุมเครือ -- ให้ย่อชื่อพวกมัน

เช่น:

- `list` -> `lst`.
- `userAgent` -> `ua`.
- `browser` -> `brsr`.
- ...ฯลฯ

เฉพาะผู้ที่มีเซนส์ที่ดีจริงๆ เท่านั้นที่จะสามารถเข้าใจชื่อดังกล่าวได้ การพยายามย่อทุกอย่าง มีเพียงคนที่คู่ควรเท่านั้นที่ควรจะสามารถสนับสนุนการพัฒนาโค้ดของคุณได้

## ใช้แต่ชื่อนามธรรม

```quote author="เล่าจื๊อ (เต้าเต๋อจิง)"
มุมมนลับเลือน จตุรัสใหญ่,<br>
ภาชนะโล่งว่าง บรรจุความสมบูรณ์,<br>
เสียงท่วงทำนอง ริบหรี่อันไพเราะ,<br>
รูปโฉมไร้เงา สะท้อนความยิ่งใหญ่
```

ในขณะที่เลือกชื่อ พยายามใช้คำที่นามธรรมที่สุด เช่น `obj`, `data`, `value`, `item`, `elem` เป็นต้น

- **ชื่อที่เหมาะสำหรับตัวแปรคือ `data`** ใช้มันทุกที่ที่คุณทำได้ แน่นอน ทุกตัวแปรเก็บ *ข้อมูล (data)* ใช่ไหม?

  ...แต่จะทำอย่างไรถ้า `data` ถูกนำไปใช้แล้ว? ลอง `value` มันก็เป็นสากลเช่นกัน ท้ายที่สุด ตัวแปรจะได้รับ *ค่า (value)* ในที่สุด

- **ตั้งชื่อตัวแปรตามประเภท: `str`, `num`...**

  ลองใช้ดู ผู้เริ่มต้นวัยเยาว์อาจสงสัยว่า -- ชื่อดังกล่าวเป็นประโยชน์จริงๆ สำหรับนินจาหรือไม่? แน่นอนว่าเป็น!

  แน่นอน ชื่อตัวแปรยังคงมีความหมายบางอย่าง มันบอกว่าอะไรอยู่ภายในตัวแปร: สตริง ตัวเลข หรืออย่างอื่น แต่เมื่อคนนอกพยายามทำความเข้าใจโค้ด พวกเขาจะประหลาดใจที่เห็นว่าไม่มีข้อมูลเลย! และสุดท้ายก็ไม่สามารถเปลี่ยนแปลงโค้ดที่คุณคิดมาอย่างดีได้

  ประเภทของค่าสามารถหาได้ง่ายโดยการดีบัก แต่ความหมายของตัวแปรคืออะไร? มันเก็บสตริง/ตัวเลขอะไรไว้?

  ไม่มีทางที่จะรู้ได้โดยไม่ต้องทำสมาธิอย่างดี!

- **...แต่ถ้าชื่อเหล่านั้นถูกใช้ไปแล้วล่ะ?** เพียงแค่เพิ่มตัวเลข: `data1, item2, elem5`...

## บททดสอบความเอาใจใส่

เฉพาะโปรแกรมเมอร์ที่เอาใจใส่จริงๆ เท่านั้นที่จะสามารถเข้าใจโค้ดของคุณได้ แต่จะตรวจสอบได้อย่างไร?

**หนึ่งในวิธี -- ใช้ชื่อตัวแปรที่คล้ายคลึงกัน เช่น `date` และ `data`**

ผสมพวกมันให้ทั่ว

การอ่านโค้ดดังกล่าวอย่างรวดเร็วเป็นไปไม่ได้ และเมื่อมีการพิมพ์ผิด... อืม... เราก็ติดอยู่นาน ทีนี้ก็ได้เวลาจิบชา


## ใช้คำพ้องความหมายฉลาดๆ

```quote author="เล่าจื๊อ (เต้าเต๋อจิง)"
เต๋าอันแท้จริงไร้ถ้อยใดบรรยาย นามอันแท้จริงไร้ชื่อใดเรียกขาน
```

การใช้ชื่อที่ *คล้าย* กันสำหรับสิ่งที่ *เหมือน* กัน ทำให้ชีวิตน่าสนใจยิ่งขึ้นและแสดงความคิดสร้างสรรค์ของคุณต่อสาธารณะ

ตัวอย่างเช่น พิจารณาคำนำหน้าของฟังก์ชัน หากฟังก์ชันแสดงข้อความบนหน้าจอ -- ให้เริ่มต้นด้วย `display…` เช่น `displayMessage` จากนั้นหากฟังก์ชันแสดงบางอย่างบนหน้าจอ เช่น ชื่อผู้ใช้ ให้เริ่มต้นด้วย `show…` (เช่น `showName`)

แนะนำว่ามีเพียงความแตกต่างเล็กน้อยระหว่างฟังก์ชันดังกล่าว ขณะที่ไม่มีเลย

ทำข้อตกลงกับนินจาในทีม: หากจอห์นเริ่ม "แสดง" ฟังก์ชันด้วย `display…` ในโค้ดของเขา แล้วปีเตอร์สามารถใช้ `render…` และแอน – `paint…` สังเกตว่าโค้ดนั้นน่าสนใจและหลากหลายมากขึ้น

...และตอนนี้กลเม็ดเด็ด!

สำหรับฟังก์ชันสองฟังก์ชันที่มีความแตกต่างที่สำคัญ -- ดันใช้คำนำหน้าเดียวกัน!

ตัวอย่างเช่น ฟังก์ชัน `printPage(หน้า)` จะใช้เครื่องพิมพ์ และฟังก์ชัน `printText(ข้อความ)` จะใส่ข้อความบนหน้าจอ ให้ผู้อ่านที่ไม่คุ้นเคยคิดทบทวนฟังก์ชันที่มีชื่อคล้ายกัน `printMessage`: "มันใส่ข้อความที่ไหน? ไปที่เครื่องพิมพ์หรือบนหน้าจอ?" เพื่อให้มันโดดเด่นจริงๆ `printMessage(ข้อความ)` ควรแสดงผลในหน้าต่างใหม่!!

## ใช้ชื่อซ้ำ

```quote author="เล่าจื๊อ (เต้าเต๋อจิง)"
เมื่อองค์รวมแยกสลาย สรรพสิ่งล้วนปรากฏนาม<br>
นามมากมายล้นหลาม ควรหยุดยั้งเมื่อพอดี
```

เพิ่มตัวแปรใหม่เฉพาะเมื่อจำเป็นเท่านั้น

แทนที่จะใช้ชื่อใหม่ ให้ใช้ชื่อที่มีอยู่เดิม เพียงแค่เขียนค่าใหม่ลงไป

ในฟังก์ชัน พยายามใช้เฉพาะตัวแปรที่ส่งผ่านเป็นพารามิเตอร์

สิ่งนั้นจะทำให้ยากต่อการระบุว่าอะไรอยู่ในตัวแปร *ตอนนี้* และมาจากไหน วัตถุประสงค์คือการพัฒนาสัญชาตญาณและความทรงจำของบุคคลที่อ่านโค้ด บุคคลที่มีสัญชาตญาณอ่อนแอจะต้องวิเคราะห์โค้ดทีละบรรทัดและติดตามการเปลี่ยนแปลงผ่านทุกสาขาของโค้ด

**รูปแบบขั้นสูงของวิธีนี้คือการแทนที่ค่าอย่างลับๆ (!) ด้วยสิ่งที่คล้ายคลึงกันในกลางลูปหรือฟังก์ชัน**

ตัวอย่างเช่น:

```js
function ninjaFunction(elem) {
  // 20 บรรทัดของโค้ดที่ทำงานกับ elem

  elem = clone(elem);

  // 20 บรรทัดเพิ่มเติม โดยตอนนี้ทำงานกับโคลนของ elem!
}
```

โปรแกรมเมอร์เพื่อนร่วมทีมที่ต้องการทำงานกับ `elem` ในครึ่งหลังของฟังก์ชันจะประหลาดใจ... ระหว่างการดีบักเท่านั้น หลังจากตรวจสอบโค้ดแล้ว พวกเขาจะพบว่าพวกเขากำลังทำงานกับโคลน!

พบเห็นในโค้ดบ่อยๆ มีประสิทธิภาพร้ายแรง แม้กระทั่งกับนินจาที่มีประสบการณ์

## การใช้ underscore เพื่อความสนุก

ใส่ underscore `_` และ `__` ก่อนชื่อตัวแปร เช่น `_name` หรือ `__value` มันจะดีมากถ้าคุณเป็นคนเดียวที่รู้ความหมายของมัน หรือดีกว่านั้น เพิ่มเข้าไปเพื่อความสนุก โดยไม่มีความหมายอะไรเลย หรือมีความหมายต่างกันในสถานที่ต่างๆ

คุณยิงปืนนัดเดียวได้นกสองตัว ประการแรก โค้ดจะยาวขึ้นและอ่านยากขึ้น ประการที่สอง นักพัฒนาร่วมทีมอาจใช้เวลานานในการพยายามหาว่า underscore หมายถึงอะไร

นินจาที่ฉลาดจะใส่ underscore ในจุดหนึ่งของโค้ดและหลีกเลี่ยงมันในสถานที่อื่น ๆ สิ่งนั้นทำให้โค้ดเปราะบางยิ่งขึ้นและเพิ่มโอกาสของข้อผิดพลาดในอนาคต

**หมายเหตุ:** การใช้ underscore ในลักษณะนี้นับว่าเป็นการเขียนโค้ดที่ไม่ดี จะทำให้โค้ดอ่านยาก เข้าใจยาก และอาจนำไปสู่ข้อผิดพลาดได้ในอนาคต หลีกเลี่ยงการใช้ underscore ในลักษณะนี้และพยายามตั้งชื่อตัวแปรที่มีความหมายชัดเจน

## แสดงความรักของคุณ

ปล่อยให้ทุกคนได้เห็นว่าตัวแปรของคุณงดงามเพียงใด! ชื่ออย่าง `superElement`, `megaFrame` และ `niceItem` จะสร้างความกระจ่างให้กับผู้อ่านอย่างแน่นอน

แน่นอน จากด้านหนึ่ง มีบางสิ่งถูกเขียนไว้ `super..`, `mega..`, `nice..` แต่จากอีกด้านหนึ่ง - มันก็ไม่ได้บอกรายละเอียดอะไรเลย ผู้อ่านอาจตัดสินใจค้นหาความหมายที่ซ่อนอยู่และทำสมาธิเป็นเวลาหนึ่งหรือสองชั่วโมงในเวลาทำงานที่ได้รับค่าตอบแทน


## ทับซ้อนตัวแปรภายนอก

ใช้นามเดียวกันสำหรับตัวแปรภายในและภายนอกฟังก์ชั่น ง่ายๆ ไม่ต้องเสียเวลาคิดชื่อใหม่

```js
let **user** = authenticateUser();

function render() {
  let **user** = anotherValue();
  ...
  ...หลายบรรทัด...
  ...
  ... // <-- โปรแกรมเมอร์ต้องการทำงานกับตัวแปร user ที่นี่และ...
  ...
}
```

โปรแกรมเมอร์ที่เข้ามาใน `render` อาจไม่สังเกตว่ามีตัวแปร `user` ทั้งข้างนอกและข้างในฟังก์ชัน และอาจจะเข้าใจว่ามันเป็นตัวแปรเดียวกัน

จากนั้นพวกเขาจะพยายามทำงานกับ `ผู้ใช้` โดยคิดว่ามันเป็นตัวแปรภายนอก ผลลัพธ์ของ `authenticateUser()` ... กับดักถูกเปิดใช้งาน! สวัสดี, debugger ...


## ผลข้างเคียง (Side effects) อยู่ทุกหนทุกแห่ง!

มีฟังก์ชันบางอย่างที่ดูเหมือนจะไม่เปลี่ยนแปลงอะไรเลย เช่น `isReady()`, `checkPermission()`, `findTags()`... ฟังก์ชันเหล่านี้ถือว่ามีการคำนวณ ค้นหา และส่งคืนข้อมูล โดยไม่เปลี่ยนแปลงอะไรนอกเหนือจากนั้น กล่าวอีกนัยหนึ่งคือ ไม่มี "ผลข้างเคียง"

**เทคนิคที่สวยงามอย่างแท้จริงคือการเพิ่มการทำงาน "ที่มีประโยชน์" นอกเหนือจากงานหลัก**

ท่าทางตกตะลึงของเพื่อนร่วมงานของคุณเมื่อเห็นฟังก์ชันที่ชื่อ `is..`, `check..`, หรือ `find...` เปลี่ยนแปลงบางอย่าง -- แน่นอนว่าจะขยายขอบเขตของเหตุผลของคุณ

**อีกวิธีหนึ่งที่น่าประหลาดใจคือการส่งคืนผลลัพธ์ที่ไม่เหมือนกันเลยทุกครั้งที่ทำงาน**

แสดงความคิดริเริ่มของคุณ! ให้การเรียกใช้ `checkPermission` ไม่ใช่แค่การส่งคืน `true/false` แต่เป็นอ็อบเจ็กต์ที่ซับซ้อนพร้อมผลลัพธ์ของการตรวจสอบ

นักพัฒนาซอฟต์แวร์ที่พยายามเขียน `if (checkPermission(..))` จะสงสัยว่าทำไมมันไม่ทำงาน บอกพวกเขาว่า: "อ่านเอกสารประกอบ!" และให้บทความนี้แก่พวกเขา


## ฟังก์ชันสุดทรงพลัง

```quote author="เล่าจื๊อ (เต้าเต๋อจิง)"
มหาเต๋าไหลลื่นทั่วทุกหน
ทั้งซ้ายขวา ไร้ขีดคั่น
```

อย่าจำกัดฟังก์ชั่นโดยสิ่งที่เขียนไว้ในชื่อ ให้กว้างขึ้น

ตัวอย่างเช่น ฟังก์ชั่น `validateEmail(email)` นอกจากจะตรวจสอบความถูกต้องของอีเมลแล้ว ยังสามารถแสดงข้อผิดพลาดและขอให้ป้อยอีเมลอีกครั้งอีก

การกระทำเพิ่มเติมไม่ควรชัดเจนจากชื่อฟังก์ชั่น โค้ดเดอร์นินจาตัวจริงจะทำให้พวกเขามองไม่เห็นจากโค้ดเช่นกัน

**การรวมหลายการกระทำเข้าด้วยกันจะช่วยป้องกันโค้ดของคุณจากการนำกลับมาใช้ใหม่**

ลองนึกภาพว่านักพัฒนาคนอื่นต้องการตรวจสอบอีเมลเท่านั้น และไม่ต้องการแสดงข้อความใด ๆ ฟังก์ชันของคุณ `validateEmail(email)` ที่ทำทั้งสองอย่างจะไม่เหมาะกับพวกเขา ดังนั้นพวกเขาจะไม่ทำลายสมาธิของคุณโดยการถามอะไรเกี่ยวกับมัน


## สรุป

"คำแนะนำ" ทั้งหมดข้างต้นมาจากโค้ดจริง... บางครั้งเขียนโดยนักพัฒนาที่มีประสบการณ์ อาจจะมากประสบการณ์กว่าคุณด้วยซ้ำ ;)

- ทำตามบางข้อ แล้วโค้ดของคุณจะเต็มไปด้วยความประหลาดใจ
- ทำตามหลายข้อ แล้วโค้ดของคุณจะกลายเป็นของคุณอย่างแท้จริง ไม่มีใครอยากเปลี่ยนแปลง
- ทำตามทั้งหมด แล้วโค้ดของคุณจะกลายเป็นบทเรียนอันทรงคุณค่าสำหรับนักพัฒนาหนุ่มสาวที่มองหาความรู้แจ้ง ซึ่งเราประชดนะ (กรุณาอย่าทำตามข้อทั้งหมดที่เราได้กล่าวมา)
