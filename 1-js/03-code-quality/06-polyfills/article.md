
## Polyfills และ Transpilers

ภาษา JavaScript มีการพัฒนาอย่างต่อเนื่อง ข้อเสนอใหม่ๆ สำหรับภาษาจะปรากฏขึ้นเป็นประจำ พวกเขาจะถูกวิเคราะห์และถ้าเห็นว่าเหมาะสมจะถูกเพิ่มเข้าไปในรายการที่ [https://tc39.github.io/ecma262/](https://tc39.github.io/ecma262/) และจากนั้นจะไปต่อที่ ข้อกำหนด: [https://www.ecma-international.org/publications-and-standards/standards/ecma-262/](https://www.ecma-international.org/publications-and-standards/standards/ecma-262/)

ทีมงานเบื้องหลังเอนจิ้น JavaScript มีแนวคิดของตัวเองว่าจะทำอะไรก่อน พวกเขาอาจตัดสินใจที่จะนำข้อเสนอที่อยู่ในร่างและเลื่อนสิ่งที่อยู่ในข้อกำหนดออกไป เพราะสิ่งเหล่านั้นไม่น่าสนใจหรือทำได้ยากกว่า

ดังนั้นจึงเป็นเรื่องปกติที่เอนจิ้นจะใช้งานเพียงบางส่วนของข้อกำหนด

หน้าเว็บที่ดีในการดูสถานะปัจจุบันของการรองรับฟีเจอร์ของภาษาคือ [https://kangax.github.io/compat-table/es6/](https://kangax.github.io/compat-table/es6/) (มันใหญ่ เรายังมีอีกหลายอย่างที่ต้องเรียนรู้)

ในฐานะโปรแกรมเมอร์ เราต้องการใช้ฟีเจอร์ล่าสุด ยิ่งมีของดีมากเท่าไหร่ก็ยิ่งดี!

ในทางกลับกัน เราจะทำอย่างไรให้โค้ดสมัยใหม่ของเราทำงานบนเอนจิ้นรุ่นเก่าที่ยังไม่เข้าใจฟีเจอร์ล่าสุดได้?

มีเครื่องมืออยู่สองอย่าง:

1. Transpilers.
2. Polyfills.

ในบทนี้ วัตถุประสงค์ของเราคือการทำความเข้าใจว่าพวกมันทำงานอย่างไร และตำแหน่งของพวกมันในการพัฒนาเว็บ

## Transpilers: เปลี่ยนภาษาให้เข้าใจกัน

**Transpiler** (นึกถึงคำว่า "แปลภาษา") เป็นเครื่องมือพิเศษที่ช่วยแปลงโค้ดจากภาษาหนึ่งไปเป็นอีกภาษาหนึ่ง  เปรียบเหมือนล่ามแปลภาษาที่อ่านแล้วเข้าใจโค้ดสมัยใหม่ แล้วเขียนใหม่ด้วยไวยากรณ์แบบเก่า เพื่อให้ทำงานได้กับเอนจิ้นรุ่นเก่า

ยกตัวอย่างเช่น ใน JavaScript ก่อนปี 2020 ไม่มีตัวดำเนินการ "nullish coalescing" `??` ดังนั้นถ้าผู้เยี่ยมชมเว็บไซต์ใช้เบราว์เซอร์รุ่นเก่า โค้ดอย่าง `height = height ?? 100` อาจทำงานไม่ถูก

Transpiler จะวิเคราะห์โค้ดของเราแล้วเขียน `height ?? 100` ใหม่เป็น `(height !== undefined && height !== null) ? height : 100`

```js
// ก่อนรัน transpiler
height = height ?? 100;

// หลังรัน transpiler
height = (height !== undefined && height !== null) ? height : 100;
```

ตอนนี้โค้ดที่เขียนใหม่ก็ใช้งานได้กับเอนจิ้น JavaScript รุ่นเก่าแล้ว

โดยทั่วไป นักพัฒนาจะรัน transpiler บนคอมพิวเตอร์ของตัวเอง จากนั้นนำโค้ดที่ผ่านการแปลงแล้วไปใช้บนเซิร์ฟเวอร์

ตัวอย่าง transpiler ที่โดดเด่นคือ **Babel** (นึกถึงคำว่า "บาเบล" ที่แปลว่า "หอคอยแห่งการสื่อสาร")

ระบบบิลด์โปรเจกต์สมัยใหม่ (Modern project build systems) เช่น **webpack** (นึกถึงคำว่า "แพ็คของ") รองรับการรัน transpiler โดยอัตโนมัติทุกครั้งที่มีการเปลี่ยนแปลงโค้ด ทำให้การทำงานกับ transpiler ง่ายดายมาก

## Polyfills: ตัวอุดรอยรั่ว

ฟีเจอร์ใหม่ของภาษาอาจไม่เพียงแค่ไวยากรณ์และตัวดำเนินการ แต่ยังรวมถึงฟังก์ชันในตัวอย่างเช่น `Math.trunc(n)` เป็นฟังก์ชันที่ "ตัดทอน" ส่วนทศนิยมของตัวเลข เช่น `Math.trunc(1.23)` จะส่งคืน `1`

ในเอนจิ้น JavaScript บางรุ่น (รุ่นเก่ามาก) ไม่มี `Math.trunc` ดังนั้นโค้ดดังกล่าวจะไม่ทำงาน

เนื่องจากเรากำลังพูดถึงฟังก์ชันใหม่ ไม่ใช่การเปลี่ยนแปลงไวยากรณ์ เราจึงไม่จำเป็นต้อง transpile อะไรเลย เราแค่ต้องประกาศฟังก์ชันที่หายไป

สคริปต์ที่อัปเดต/เพิ่มฟังก์ชันใหม่เรียกว่า "polyfill" มัน "เติมเต็มช่องว่าง" และเพิ่มการใช้งานที่หายไป

สำหรับกรณีนี้ polyfill สำหรับ `Math.trunc` เป็นสคริปต์ที่นำไปใช้งาน ดังนี้:

```js
if (!Math.trunc) { // ถ้าไม่มีฟังก์ชันดังกล่าว
  // นำไปใช้งาน
  Math.trunc = function(number) {
    // Math.ceil และ Math.floor มีอยู่แม้กระทั่งในเอนจิ้น JavaScript รุ่นเก่า
    // จะกล่าวถึงในบทเรียนต่อไป
    return number < 0 ? Math.ceil(number) : Math.floor(number);
  };
}
```

JavaScript เป็นภาษาที่มีความคล่องตัวสูง สคริปต์สามารถเพิ่ม/แก้ไขฟังก์ชันใดๆ ได้แม้กระทั่งฟังก์ชันในตัว

ไลบรารี polyfill ที่น่าสนใจสองแห่ง:

- core js: [https://github.com/zloirock/core-js](https://github.com/zloirock/core-js) ที่รองรับหลายอย่าง อนุญาตให้รวมเฉพาะฟีเจอร์ที่ต้องการ
- polyfill.io: [https://polyfill.io/](https://polyfill.io/) บริการที่จัดหาสคริปต์ที่มี polyfills ขึ้นอยู่กับฟีเจอร์และเบราว์เซอร์ของผู้ใช้

## สรุป

ในบทนี้ เราอยากกระตุ้นให้คุณศึกษาฟีเจอร์ภาษาใหม่ๆ แม้กระทั่งฟีเจอร์ที่ล้ำสมัย แม้ว่าเอนจิ้น JavaScript ยังไม่รองรับอย่างเต็มที่

เพียงแค่อย่าลืมใช้ transpiler (ถ้าใช้ไวยากรณ์หรือตัวดำเนินการสมัยใหม่) และ polyfills (เพื่อเพิ่มฟังก์ชันที่อาจหายไป) พวกมันจะทำให้โค้ดทำงานได้อย่างถูกต้อง

ตัวอย่างเช่น ต่อมาเมื่อคุณคุ้นเคยกับ JavaScript คุณสามารถตั้งค่าระบบบิลด์โค้ดบนพื้นฐานของ webpack: [https://webpack.js.org/guides/getting-started/](https://webpack.js.org/guides/getting-started/) พร้อมกับปลั๊กอิน babel-loader: [https://github.com/babel/babel-loader](https://github.com/babel/babel-loader)

แหล่งข้อมูลที่ดีที่แสดงสถานะปัจจุบันของการรองรับฟีเจอร์ต่างๆ:
- [https://github.com/compat-table/compat-table](https://github.com/compat-table/compat-table) - สำหรับ JavaScript แบบเพียวๆ
- [https://caniuse.com/](https://caniuse.com/) - สำหรับฟังก์ชันที่เกี่ยวข้องกับเบราว์เซอร์

ปล. Google Chrome มักจะเป็นเวอร์ชันล่าสุดพร้อมฟีเจอร์ภาษา ลองใช้ดูถ้าการสาธิตบทเรียนไม่ทำงาน อย่างไรก็ตาม บทเรียนส่วนใหญ่จะทำงานได้กับเบราว์เซอร์สมัยใหม่ทุกชนิด