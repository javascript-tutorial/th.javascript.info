## ตัวดำเนินการ Nullish Coalescing '??'

[recent browser="new"]

ตัวดำเนินการ Nullish Coalescing เขียนด้วยเครื่องหมายคำถามสองตัว `??`

เนื่องจากตัวดำเนินการนี้ถือว่า `null` และ `undefined` คล้ายคลึงกัน เราจะใช้คำศัพท์พิเศษที่นี่ ในบทความนี้ เพื่อความกระชับ เราจะบอกว่าค่า "กำหนด" เมื่อไม่ใช่ `null` หรือ `undefined`

ผลลัพธ์ของ `a ?? b` คือ:
- ถ้า `a` ถูกกำหนด ให้คืนค่า `a`
- ถ้า `a` ไม่ถูกกำหนด ให้คืนค่า `b`

กล่าวอีกนัยหนึ่ง `??` จะส่งคืนอาร์กิวเมนต์แรกถ้าไม่ใช่ `null/undefined` มิฉะนั้นจะส่งคืนอาร์กิวเมนต์ที่สอง

ตัวดำเนินการ Nullish Coalescing ไม่ใช่สิ่งใหม่ทั้งหมด มันเป็นเพียงไวยากรณ์ที่สวยงามเพื่อรับค่า "กำหนด" แรกของทั้งสอง

เราสามารถเขียน `result = a ?? b` ใหม่โดยใช้ตัวดำเนินการที่เรารู้จักอยู่แล้ว ดังนี้:

```js
result = (a !== null && a !== undefined) ? a : b;
```

ตอนนี้ชัดเจนแล้วว่า `??` ทำอะไร มาดูกันว่ามันช่วยอะไรได้บ้าง

กรณีการใช้งานทั่วไปของ `??` คือการกำหนดค่าเริ่มต้น

ตัวอย่างเช่น ที่นี่เราแสดง `user` ถ้าค่าไม่ใช่ `null/undefined` มิฉะนั้นจะแสดง `Anonymous`:

```js run
let user;

alert(user ?? "Anonymous"); // Anonymous (user is undefined)
```

นี่คือตัวอย่างที่มีการกำหนดชื่อให้กับ `user`:

```js run
let user = "John";

alert(user ?? "Anonymous"); // John (user is not null/undefined)
```

เราสามารถใช้ลำดับของ `??` เพื่อเลือกค่าแรกจากรายการที่ไม่ใช่ `null/undefined`

สมมติว่าเรามีข้อมูลของผู้ใช้ในตัวแปร `firstName`, `lastName` หรือ `nickName` ทั้งหมดนี้อาจไม่ถูกกำหนด ถ้าผู้ใช้ตัดสินใจไม่กรอกค่าที่เกี่ยวข้อง

เราต้องการแสดงชื่อผู้ใช้โดยใช้ตัวแปรเหล่านี้ตัวใดตัวหนึ่ง หรือแสดง "Anonymous" ถ้าทั้งหมดเป็น `null/undefined`

ลองใช้ตัวดำเนินการ `??` สำหรับสิ่งนั้น:

```js run
let firstName = null;
let lastName = null;
let nickName = "Supercoder";

// แสดงค่าที่กำหนดตัวแรก:
*!*
alert(firstName ?? lastName ?? nickName ?? "Anonymous"); // Supercoder
*/!*
```

## เปรียบเทียบกับ ||

ตัวดำเนินการ OR `||` สามารถใช้ในลักษณะเดียวกับ `??` ตามที่อธิบายไว้ใน บทก่อนหน้า: info:logical-operators#or-finds-the-first-truthy-value

ตัวอย่างเช่น ในโค้ดข้างต้น เราสามารถแทนที่ `??` ด้วย `||` และยังคงได้ผลลัพธ์เดียวกัน:

```js run
let firstName = null;
let lastName = null;
let nickName = "Supercoder";

// แสดงค่า truthy ตัวแรก:
*!*
alert(firstName || lastName || nickName || "Anonymous"); // Supercoder
*/!*
```

ในอดีต ตัวดำเนินการ OR `||` อยู่ก่อน มันมีมาตั้งแต่ต้นของ JavaScript ดังนั้นนักพัฒนาจึงใช้มันเพื่อวัตถุประสงค์ดังกล่าวมาเป็นเวลานาน

ในทางกลับกัน ตัวดำเนินการ Nullish Coalescing `??` เพิ่งถูกเพิ่มเข้ามาใน JavaScript เมื่อไม่นานมานี้ และเหตุผลก็คือผู้คนไม่ค่อยพอใจกับ `||`

ความแตกต่างที่สำคัญระหว่างทั้งสองคือ:
- `||` จะส่งคืนค่า *truthy* ตัวแรก
- `??` จะส่งคืนค่า *defined* ตัวแรก

กล่าวอีกนัยหนึ่ง `||` ไม่แยกแยะระหว่าง `false`, `0`, สตริงว่าง `""` และ `null/undefined` พวกมันทั้งหมดเหมือนกัน -- ค่า falsy ถ้าใดๆ เหล่านี้เป็นอาร์กิวเมนต์แรกของ `||`  เราจะได้อาร์กิวเมนต์ที่สองเป็นผลลัพธ์

อย่างไรก็ตาม ในทางปฏิบัติ เราอาจต้องการใช้ค่าเริ่มต้นเฉพาะเมื่อตัวแปรเป็น `null/undefined` นั่นคือ เมื่อค่าไม่รู้จัก/ไม่ได้ตั้งค่าจริงๆ

ตัวอย่างเช่น ลองพิจารณาสิ่งนี้:

```js run
let height = 0;

alert(height || 100); // 100
alert(height ?? 100); // 0
```
- `height || 100` ตรวจสอบ `height` ว่าเป็นค่า falsy หรือไม่ และเป็น `0` ซึ่งเป็นค่า falsy จริงๆ
  - ดังนั้นผลลัพธ์ของ `||` คืออาร์กิวเมนต์ที่สอง `100`
- `height ?? 100` ตรวจสอบ `height` ว่าเป็น `null/undefined` หรือไม่ และไม่ใช่
  - ดังนั้นผลลัพธ์คือ `height` "ตามที่เป็นอยู่" นั่นคือ `0`

ในทางปฏิบัติ `height` เป็นศูนย์มักจะเป็นค่าที่ถูกต้อง ไม่ควรแทนที่ด้วยค่าเริ่มต้น ดังนั้น `??` ทำสิ่งที่ถูกต้อง

## ลำดับความสำคัญ

ลำดับความสำคัญของตัวดำเนินการ `??` เท่ากับ `||` ทั้งคู่มีค่าเท่ากับ `3` ในตาราง MDN: [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#Table](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#Table)

นั่นหมายความว่า เช่นเดียวกับ `||` ตัวดำเนินการ Nullish Coalescing `??` จะถูกประเมินก่อน `=` และ `?` แต่หลังจากการดำเนินการอื่นๆ ส่วนใหญ่ เช่น `+`, `*`

ดังนั้น เราอาจต้องเพิ่มวงเล็บในนิพจน์เช่นนี้:

```js run
let height = null;
let width = null;

// สิ่งสำคัญ: ใช้วงเล็บ
let area = (height ?? 100) * (width ?? 50);

alert(area); // 5000
```

มิฉะนั้น ถ้าเราละเว้นวงเล็บ เนื่องจาก `*` มีลำดับความสำคัญสูงกว่า `??` มันจะทำงานก่อน ทำให้ผลลัพธ์ไม่ถูกต้อง

```js
// ไม่มีวงเล็บ
let area = height ?? 100 * width ?? 50;

// ...ทำงานแบบนี้ (ไม่ใช่สิ่งที่เราต้องการ):
let area = height ?? (100 * width) ?? 50;
```

### ใช้ ?? ร่วมกับ && หรือ ||

ด้วยเหตุผลด้านความปลอดภัย JavaScript ห้ามใช้ `??` ร่วมกับตัวดำเนินการ `&&` และ `||` เว้นแต่ลำดับความสำคัญจะระบุไว้ชัดเจนด้วยวงเล็บ

โค้ดด้านล่างนี้จะทำให้เกิดข้อผิดพลาดทางไวยากรณ์:

```js run
let x = 1 && 2 ?? 3; // Syntax error
```

สิ่งนี้เป็นข้อจำกัดของภาษา มันถูกเพิ่มเข้าไปในสเปกภาษาเพื่อวัตถุประสงค์ในการหลีกเลี่ยงข้อผิดพลาดในการเขียนโปรแกรม เมื่อผู้คนเริ่มเปลี่ยนจาก `||` เป็น `??`

ใช้วงเล็บเพื่อแก้ไขปัญหา:

```js run
*!*
let x = (1 && 2) ?? 3; // Works
*/!*

alert(x); // 2
```

## สรุป

- ตัวดำเนินการ Nullish Coalescing `??` ช่วยให้เรากำหนดค่าเริ่มต้นให้กับตัวแปรได้อย่างง่ายดาย ในการเลือกค่า "defined" แรกจากรายการ

  ใช้เพื่อกำหนดค่าเริ่มต้นให้กับตัวแปร:

    ```js
    // ตั้งค่า height=100, ถ้า height เป็น null หรือ undefined
    height = height ?? 100;
    ```

- ตัวดำเนินการ `??` มีลำดับความสำคัญต่ำมาก สูงกว่า `?` และ `=` เล็กน้อย ดังนั้นควรพิจารณาเพิ่มวงเล็บเมื่อใช้ในนิพจน์
- ห้ามใช้กับ `||` หรือ `&&` โดยไม่มีวงเล็บ